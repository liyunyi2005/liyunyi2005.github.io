---
title: 视觉光电分拣小车实战笔记
published: 2024-12-15
description: 四自由度舵机驱动、八路循迹、树莓派上位机与视觉分拣流程的完整搭建步骤。
tags: ["Raspberry Pi", "机器人", "视觉", "循迹", "舵机"]
category: Guides
draft: false
---

> 参考本目录下的 `index.md`，保持相同的 front-matter 结构与段落层级，便于后续维护与渲染。

## 方案概览

- 底盘：直流电机驱动，八路循迹模块（数字量输出）负责循迹与偏差修正。
- 机械臂：四自由度舵机（含末端夹爪），通过 PWM 驱动，负责取放物料。
- 上位机：树莓派作为控制与视觉节点，运行分拣逻辑与相机推理。
- 通讯：树莓派通过串口/UART 或 I2C 与底盘/舵机控制板通讯；相机直接接树莓派。
- 软件：Python 或 Node.js 进程负责视觉推理、路径决策、分拣指令下发；底层控制板运行简化 PID/循迹逻辑。

## 硬件清单（示例）

| 模块               | 说明                              |
|--------------------|-----------------------------------|
| 树莓派 4B/3B+      | 上位机与视觉推理                  |
| CSI/USB 摄像头     | 视觉识别与分拣决策                |
| 八路循迹传感器     | 数字量输出，检测黑线/色带         |
| 电机驱动 + 底盘    | 直流电机/编码器（可选）           |
| 四自由度舵机套件   | 含末端夹爪，支持 PWM 控制         |
| 电源               | 5V/3A（树莓派）、舵机独立供电更稳 |

## 系统连接

1. 循迹模块：将 8 路数字输出接入控制板/单片机的 GPIO，提供左右偏差信号。
2. 舵机：接入舵机驱动板（如 PCA9685）或带 PWM 输出的控制板，确保单独供电。
3. 树莓派：
   - 摄像头接 CSI/USB。
   - 串口/UART 或 I2C 与控制板通讯，发送速度/转向/舵机指令。
   - 可选：通过 GPIO 读取紧急停机或状态信号。

## 控制流程

1. 树莓派启动视觉程序，读取相机画面，识别目标类别/颜色/位置。
2. 根据识别结果计算分拣位姿与路径，生成动作序列（底盘停靠 → 机械臂取物 → 机械臂放置）。
3. 实时读取循迹状态，保持沿线运动；到达分拣点后停靠。
4. 下发舵机角度序列（如“抓取 → 抬升 → 移动 → 放置 → 复位”）。
5. 处理异常：超时/未检测到目标/偏差过大时重新规划或返回起点。

## 部署步骤（树莓派）

```bash
# 1) 更新系统
sudo apt update && sudo apt upgrade -y

# 2) 安装依赖（示例：Python + OpenCV）
sudo apt install -y python3-opencv python3-pip
pip install numpy opencv-python

# 3) 启用串口/I2C（raspi-config）
sudo raspi-config

# 4) 运行你的视觉/控制脚本
python3 vision_sort.py
```

> 如果用 Node.js，可改为安装 `node`, `npm`/`pnpm`，并在脚本中使用 `onoff`/`pigpio` 控制 GPIO，或用 `serialport` 与控制板通讯。

## 视觉与分拣策略要点

- 统一坐标系：相机坐标 → 小车/机械臂坐标的转换需标定（标定板或多点标定）。
- 光照与背景：使用固定光源或遮光罩，降低曝光波动对识别的影响。
- 置信度阈值：识别到的目标需满足最小置信度与面积/形状约束，防止误分拣。
- 舵机限位：在指令层加入角度/速度限制，避免超行程；上电前先复位到安全位姿。

## 调试与排错

- 循迹抖动：检查循迹阈值、底盘速度与 PID 参数；确认传感器安装高度一致。
- 舵机抖动/过热：分离供电、加大电容滤波，降低加速度；检查 PWM 频率（PCA9685 默认 50Hz）。
- 通讯异常：确认串口波特率、地线共地，必要时加入 CRC 校验。

## 参考与扩展

- 你可以将推理部分改为轻量化模型（如 YOLOv8n/RT-DETR），在树莓派上用 NPU（如 Coral/硬件加速）提升速度。
- 若需云端协同，可把视觉结果和日志上传到服务器，以便远程监控和参数调优。
